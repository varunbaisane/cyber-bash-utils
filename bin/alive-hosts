#!/usr/bin/env bash

set -euo pipefail

SCRIPT_PATH="$(readlink -f "${BASH_SOURCE[0]}")"
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"

CORE_COMMON="$(command -v cyber-core)"
CORE_DIR="$(cd "$(dirname "$(readlink -f "$CORE_COMMON")")/../core" && pwd)"

source "$CORE_DIR/common.sh"

parse_args "$@"

TARGET="$TARGET"

require_cmd ping

if is_ipv4 "$TARGET"; then
    if ping -c 1 -W 1 "$TARGET" >/dev/null 2>&1; then
        echo "$TARGET"
    fi
    exit 0
fi

log_info "Scanning subnet: $TARGET"

NETWORK="${TARGET%/*}"

IFS=. read -r o1 o2 o3 o4 <<< "$NETWORK"

for i in $(seq 1 254); do
    ip="$o1.$o2.$o3.$i"

    if ping -c 1 -W 1 "$ip" >/dev/null 2>&1; then
        echo "$ip"
    fi
done
